<h1>CrayPAT</h1>

<p> Category: Tools-Performance

<h2>Description</h2>

<p> CrayPat is the Cray performance analysis tool.  CrayPat is an optional performance analysis tool for evaluating program execution on Cray systems. CrayPat consists of three major components:
<ul>
 <li> pat_build - used to instrument the program to be analyzed
 <li> pat_report - a standalone text report generator that can be used to further explore the data generated by instrumented program execution
 <li> Apprentice2 - a graphical analysis tool that can be used, in addition to pat_report, to further explore and visualize the data generated by instrumented program execution
</ul>

<p> These components are described in greater detail in the pat_build, pat_report, and app2 man pages, respectively.  Note that you must have the xt-craypat (or apprentice2) module loaded first to get these man pages.  In addition, more detail about CrayPat usage and environment variables is provided in the pat man page.

<h2>Use</h2>

Follow these steps to use CrayPat to perform a basic analysis of your program.  Start with a debugged and executable program. CrayPat is a performance analysis tool, not a debugging tool. The program must be capable of running to planned completion or intentional termination before CrayPat can be useful.  Load the programming environment module. This ensures that the correct links and libraries are in place for your choice of compiler and target execution environment. For example, if you are working on a Cray XT series system and using CNL on the compute nodes, enter this command: 

<pre>
  module avail xt-craypat
  module load xt-craypat
</pre>

<p> Then compile and link your program. With the CrayPat module(s) loaded, remake or recompile your program, using the compiler option to preserve all .o files (and .a files, if any) created during compilation. CrayPat requires access to the object files (and archive files, if any).

<p> For example, if you are working with a Fortran program, enter commands like these examples:

<pre>
  % ftn -c myprogram.f
  % ftn -o myprogram myprogram.o
</pre>

<p> Use the pat_build command to insert automatic profiling analysis (APA) code into your program. The instrumented copy is saved under a new name with the extension +pat; the original program remains unchanged.

<pre>
  % pat_build -O apa myprogram
</pre>

<p> Execute the program. During execution, the specified performance analysis data is collected and written to one or more data files, depending on the experiment being conducted.

<p> On a Cray XT series CNL system, programs are executed using the aprun command.

<pre>
  % aprun myprogram+pat
</pre>

<p> On a Cray XT series system using the PBS Pro batch environment, programs are submitted using the qsub command, and yod or aprun are used as arguments to the qsub command depending on your site's choice of compute-node operating system.  Report the results.  After program execution completes or terminates, use the pat_report command to create a .apa report.

<pre>
  % pat_report -o sample.txt myprogram+pat+PID
</pre>

<p>Once a .apa file has been created, you should open the file in your preferred text editor and verify that you do not wish to have more or less profiled.  Lines that are preceeded with # will be ignored.  Any option to pat_build may be added to this file.  For most users, the file created by pat_report will be sufficient.  After you have verified this file, reinstrument your executable as follows.</p>

<pre>
  % pat_build -O &lt;apafile&gt;.apa
</pre>

<p>The resulting executable will end with +apa; run again with this executable.  As before, your executable will create either one .xf file, or a directory with multuple .xf files, depending on your processor count.  Once you have completed execution, generate a .ap2 file for pat_report or apprentice2.</p>

<pre>
  % pat_report -f ap2 &lt;output&gt;.xf
</pre>

<p>You can use this file as input to pat_report, for text reports, or apprentice2, for graphical analysis.  By default, your code will gather hardware counters from hwcp group 0.  This can be overridden at runtime by setting the PAT_RT_HWPCenvironment variable (see man hwpc).  To ignore hwpc data in your text reports, use the <code>-H</code> option to pat_report.</p>


<h2>Support</h2><p>This package has the following support level : Supported
<br>
<h2>Available Versions</h2>
<p>All versions of this software are provided by the system vendor and are not installed by NICS staff.
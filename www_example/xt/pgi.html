<h1>PGI</h1>

<p> Category: Program Dev-Compilers

<h2>Description</h2>

<p> Cray provides the <a href="http://www.pgroup.com/">Portland Group (PGI)</a> compilers as part of several programming environments.  
PGI versions 9.0.x, 8.0.x and 7.2.x are available.

<P> XTs have two kinds of nodes:

<ol>
 <li> Compute nodes running the CNL OS.
 <ul>
  <li> To build code for the compute nodes, you should use the Cray wrappers cc, CC, and ftn.
  <li> The wrappers will call the appropriate PGI compiler which will use the appropriate header files and link against the appropriate libraries.
 </ul>
 <li> Service and login nodes running Linux.
 <ul>
  <li> To build code for the Linux service nodes, you can call the PGI compilers directly.  (See list below.)
  <li> We strongly suggest that you don't call the PGI compilers directly if you are building code to run on the compute nodes.
 </ul>
</ol>

<p> The Cray wrappers cc, CC, and ftn will automatically link against MPI (-lmpi) and SciLib (-lsci).  This is not true when calling the PGI compilers directly.  See the cc, CC, and ftn man pages for more information on their usage.

<p> To see man pages on PGI compilers with a full list of compiler options, first make sure the "PrgEnv-pgi" module is loaded, and then do a man on any of the following:
<ul>
 <li> pgcc 
 <li> pgCC 
 <li> pgf90/pgf95 
 <li> pgf77 
</ul>

<p> For more detailed information, see <a href="http://www.pgroup.com/resources/docs.htm">PGI documentation</a> and <a href="http://docs.cray.com">Cray's documentation</a>.


<h2>Use</h2>

<p>To use the Cray wrappers with the PGI compilers, the PrgEnv-pgi module should be loaded:

<pre>
  module avail PrgEnv
  module swap PrgEnv-pgi PrgEnv-pgi        # this loads some version of pgi, currently 7.2.3
</pre>

To just use the PGI compilers directly, just load the pgi module you want:

<pre>
  module avail pgi
  module load pgi/7.2.3         # Note that this does not changed the Cray wrappers.
</pre>

It is possible to use the PGI compiler versions directly without loading the Cray Programming Environments, but note that
the Cray wrappers will probably not work as expected if you do that.

<p>Also note that with CNL 2.0.49 and above, the following options are set
automatically by the xtpe-quadcore module (loaded by default):
<pre>
jaguar12> module display xtpe-quadcore
-------------------------------------------------------------------
/opt/xt-asyncpe/1.0/modulefiles/xtpe-quadcore:

prepend-path     PE_PRODUCT_LIST XTPE_QUADCORE 
setenv           XTPE_QUADCORE_ENABLED ON 
setenv           LIBSCI_PRE_LINK_OPTS  -lsci_quadcore  
setenv           PGI_POST_COMPILE_OPTS   -tp barcelona-64 
setenv           PATHSCALE_POST_COMPILE_OPTS  -march=barcelona 
setenv           GNU_POST_COMPILE_OPTS  -march=barcelona 
setenv           LLVM_AMD_10H 1 
-------------------------------------------------------------------
</pre>

<p> However, the "barcelona" option works with many versions of the compiler.
<table border="1" >
<tr><th>Version<th>barcelona support</tr>
<tr><td align=center>7.2.x<td align=center>yes</tr>
</table>

<p>It is best to review the pgcc, pgCC, and pgf90 man pages for a list of their options.

<h3> C/C++ Options</h3>

<p>The following options control the amount of debugging information generated by the compiler. They can adversely affect optimization.

<table border="1">
<tr><th>Option <th>Description
<tr><td>-g<td> Generates symbolic debug information. Turns off optimization.
<tr><td>-Mbounds<td>Adds array bound checking.
</table>

<p>For most cases, the usual levels of optimization are appropriate (-O0, -O1, -O2 [default], -O3). Here are a few exceptions.

<table border="1">
<tr><th>Option <th>Description
<tr><td>-fast<td>Chooses generally optimal flags for the target platform.
Use pgcc -fast -help to see the equivalent switches.
Note this sets the optimization level to a minimum of 2; see -O.
<tr><td>-fastsse<td>Chooses generally optimal flags for a processor that supports the streaming SIMD extensions (SSE) (Pentium 3/4, AthlonXP/MP, Opteron) and SSE2 (Pentium 4, Opteron) instructions. Use pgcc -fastsse -help to see the equivalent switches.
<tr><td>-tp barcelona-64<td>Targets optimization to the 64-bit Opteron quad-core processor.
<tr><td>-Mflushz<td>Sets SSE to flush-to-zero mode.
<tr><td>-pg, -Mprof<td>Instrument program for profiling.
These flags imply different types of profiling.
Please check the <a href="http://www.nccs.gov/computing-resources/jaguar/debugging-optimization/">performance tuning pages</a> for more information.
<tr><td>-Minfo<td>Generates an optimization report to standard error.
This has several suboptions, so check the man page.
<tr><td>-mp=nonuma<td>Enables the compiler to generate multithreaded code based on the OpenMP directives.  Use the nonuma suboption when
linking with the Cray wrappers.
</table>

<p>

<h3> Fortran Options</h3>

<p>The following options control how source files are translated into machine code.

<table border="1">
<tr><th>Option <th>Description
<tr><td>-M fixed<td>The source code uses fixed-form syntax, as in Fortran 77.
This option is on by default for source files ending in .f, .F, .for, and .fpp.
<tr><td>-M free<td>The source code uses free-form syntax, introduced in Fortran 90.
This option is on by default for source files ending in .f90, .F90, .f95, .F95.
<tr><td>-F<td>This option preprocesses each file and leaves the output in a file named file.f for each file named file.F.
<tr><td>-i8<td>This option treats INTEGER variables as 8 bytes.
For operations involving integers, uses 64 bits for computations.
<tr><td>-r8<td>This option interprets REAL variables as DOUBLE PRECISION.
Equivalent to using the options -Mr8 and -Mr8intrinsics.
</table>

<p> The following options control the amount of debugging information generated by the compiler. They can adversely affect optimization.

<table border="1">
<tr><th>Option <th>Description
<tr><td>-g<td>Generates symbolic debugging information. Turns off optimization.
<tr><td>-Mbounds<td>Adds array bound checking.
<tr><td>-Mchkptr<td>Checks for unintended dereferencing of null pointers.
</table>

<p>For most cases, the usual levels of optimization are appropriate (-O0, -O1, -O2 [default], -O3). Here are a few exceptions.

<table border="1">
<tr><th>Option <th>Description
<tr><td>-fast<td>Chooses generally optimal flags for the target platform.
Use pgf90 -fast -help to see the equivalent switches.
Note this sets the optimization level to a minimum of 2; see -O.
<tr><td>-fastsse<td>Chooses generally optimal flags for a processor that supports the SSE (Pentium 3/4, AthlonXP/MP, Opteron) and SSE2 (Pentium 4, Opteron) instructions.
Use pgf90 -fastsse -help to see the equivalent switches.
<tr><td>-Mflushz<td>Sets SSE to flush-to-zero mode.
<tr><td>-pg, -Mprof<td>Instrument program for profiling.
These flags imply different types of profiling.
Please check the <a href="http://www.nccs.gov/computing-resources/jaguar/debugging-optimization/">performance tuning pages</a> for more information.
<tr><td>-Minfo<td>Generates an optimization report to standard error.
This has several suboptions, so check the man page.
<tr><td>-Mlist<td>Generates a listing file.
<tr><td>-mp=nonuma<td>Enables the compiler to generate multithreaded code based on the OpenMP directives.  Use the nonuma suboption when
linking with the Cray wrappers.
</table>


<h2>Support</h2><p>This package has the following support level : Supported
<br>
<h2>Available Versions</h2>
<p>All versions of this software are provided by the system vendor and are not installed by NICS staff.